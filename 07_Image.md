
# Images
이 장에서는 마크다운 문서에 이미지를 넣을 때 필요한 기술을 다루게 됩니다.

## SVG
SVG(Scalable Vector Graphics)는 2차원 벡터 그래픽을 표현하기 위한 XML 기반의 파일입니다.
웹의 표준과 가이드라인을 배포하는 단체인 W3C의 주도로 개발된 오픈 표준 벡터 그래픽 파일입니다.
텍스트정보로 이루어져 있으며, 검색, 목록화, 스크립트화, 압축이 가능한 포멧입니다. 벡터이미지 이므로 웹 브라우저에서 확대하거나 축소해도 화질에 변화가 없습니다.
SVG는 epub3부터 지원합니다.
SVG 포멧은 아래 소개될 특징들이 있어서 개인적으로 선호하는 포멧입니다.

#### SVG 이미지의 특징
- 벡터정보만 저장됩니다.
- 용량이 작습니다.
- 확대가 되어도 이미지의 안티알리아싱이 깨끗합니다.
- 레이어 및 추후 수정할 수 있도록 이미지 내부에 벡터정보가 살아있습니다.
- 위 특징으로 인해서 파일 생성이후 언제나 수정, 이미지의 재활용성이 좋습니다.
- SVG의 편집툴은 오픈소스부터 상용툴까지 선택폭이 넓습니다. 좋아하는 툴을 이용해서 편집이 가능합니다.
- 파일이 저장될 때 text형태로 저장되기 때문에 Git을 이용한 버전관리가 좋습니다.

## PNG
- GIF 포멧이 내부 압축 알고리즘에 소프트웨어 특허를 걸면서 탄생된 포멧입니다.
- 비손실 그래픽파일 포멧중 하나 입니다.
- E-book 제작시 이미지 손실을 최소화 하며 작업시 사용합니다.
- 여러분의 E-book에 PNG포멧을 많이 넣게되면 책의 용량이 커지고 하드웨어에 메모리 부하를 줄 수 있습니다.

## JPG
- 이미지 손실이 되는 포멧이지만 용량이 작아서 널리 사용됩니다.
- 용량을 최대로 줄이기 위해서는 10~30% 압축을 더 할 수 있는 구글에서 개발한 guetzli를 사용하면 좋습니다.
- guetzli는 jpeg를 인코딩할 때 처리시간이 조금 걸립니다. 최종적으로 최적화 할 때 사용하시면 좋습니다.
- [Guetzli](https://github.com/google/guetzli) macOS에서 설치방법
	
	brew install guetzli

- 사용방법
	
	$ guetzli origin.jpg output.jpg
	$ guetzli origin.jpg origin.jpg # 같은 파일로 덮어쓰기 가능.

## Tip
#### SVG to PNG
데이터 관리 측면에서는 당연히 SVG 포멧의 장점이 있지만, 공동작업을 위해서 
Github를 사용하거나 svg를 지원하지 않는 문서를 생성해야 할 때는 svg를 png로 컨버팅 하는것이
공동작업을 위해서 좋을 경우도 있습니다.
여러분이 SVG에서 PNG로 변환시 리눅스를 사용한다면 inkscape가 좋습니다.
아래는 inkscape를 이용해서 svg를 png로 변환하는 예제입니다.

	$ inkscape -z -e test.png -w 1024 -h 1024 test.svg

여러분이 macOS를 사용한다면 inkscape가 실행될때 실행속도가 느린것에 불만을 느낄 수 있습니다.
쾌적한 작업을 위해서 macOS에서는 librsvg를 추천합니다. 설치는 아래와 같습니다.

	brew install librsvg

설치이후 svg파일을 png로 변환하는 방법은 아래와 같습니다.
	
	$ rsvg-convert -h 800 test.svg > test_800.png

이미지 컨버팅으로 유명한 오픈소스툴인 ImageMagick은 SVG 변환시 이미지가 많이 깨지는 모습을 보여주었습니다.

#### Perl 스크립트를 이용해서 이미지를 마크다운 문법으로 일괄 변환
이전에 소개 했던대로 마크다운 문법을 이용해서 문서에 이미지를 넣는 문법은 아래와 같습니다.
	
	![이미지설명](./figures/image.png)

이미지를 문서에 넣을 때마다 매번 타이핑하는 것은 책을 만드는 과정에서 불편합니다.
이미지를 삽입할 때 아래 형태로 간편하게 작성합니다.

	Insert test.png
	이미지에 대한 설명

이후 Perl 스크립트를 이용해서 마크다운 문법으로 모든 문서의 내용을 일괄 변경할 수 있습니다.
Perl 스크립트는 아래와 같습니다.

	perl -i -0pe 's/^Insert\s*(.*).png\s*\n([^\n]*)$/!\[\2](.\/figures\/\1-tn.png)/mg' */*.md

위 Perl 스크립트가 실행되면 하위경로의 모든 마크다운 문서의 사용자 png이미지 문자열이 아래형태로 변경됩니다.

	![이미지에 대한 설명](./figures/test.png)

